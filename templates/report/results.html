{% extends "report/layout.html" %}

{% block title %} {{ ex.name }} - Crater report {% endblock %}

{% block extra_head %}
    <style>
        {% for color in result_colors %}
            .r{{ loop.index0 }} {
                {% if color.Single %}
                    background: {{ color.Single }};
                {% elif color.Striped %}
                    background: repeating-linear-gradient(-45deg, {{ color.Striped[0] }}, {{ color.Striped[0] }} 15px, {{ color.Striped[1] }} 15px, {{ color.Striped[1] }} 30px);
                {% endif %}
            }
        {% endfor %}

        {% for name, color in comparison_colors %}
            .c{{ name }} {
                {% if color.Single %}
                    background: {{ color.Single }};
                {% elif color.Striped %}
                    background: repeating-linear-gradient(-45deg, {{ color.Striped[0] }}, {{ color.Striped[0] }} 15px, {{ color.Striped[1] }} 15px, {{ color.Striped[1] }} 30px);
                {% endif %}
            }
        {% endfor %}
    </style>
{% endblock %}

{% block body %}
    {% if categories %}
        {% for iter in categories %}
            {% set name = iter.0 %}
            {% set crates = iter.1 %}
            <div class="category">
                {% if crates.Plain %}
                    <div class="header c{{ name }} toggle" data-toggle="#crt-{{ name }}">
                        {{ name }} ({{ crates.Plain|length }})
                    </div>
                    <div class="crates hidden" id="crt-{{ name }}">
                        {% for crate in crates.Plain %}
                            <div class="crate">
                                <a href="{{ crate.url|safe }}" target="_blank" rel="noopener">{{ crate.name }}</a>
                                {% for run in crate.runs %}
                                    <span class="run">
                                        {% if run %}
                                            <b class="r{{ run.res }}"></b>
                                            <a href="{{ run.log|safe }}/log.txt">
                                                {{ result_names[run.res] }}
                                            </a>
                                        {% else %}
                                            <b class="c{{ crate.res }}"></b>
                                            {{ crate.res }}
                                        {% endif %}
                                    </span>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                {% elif crates.Tree and crates.Tree.count > 0 %}
                    <div class="header c{{ name }} toggle" data-toggle="#crt-{{ name }}-tr">
                        {{ name }}: tree ({{ crates.Tree.count }} root crates, {{info[name]}} {{ name }} crates in total) 
                    </div>
                    <div class="crates hidden" id="crt-{{ name }}-tr">
                    {% for root, subcrates in crates.Tree.tree %}
                            <div class="category">
                                <div class="header header-background subheader toggle" data-toggle="#{{ name }}-tr{{ loop.index }}">
                                    {{ root }} ({{ subcrates|length }})
                                </div>
                                <div class="crates" id="{{ name }}-tr{{ loop.index }}">
                                    {% for crate in subcrates %}
                                        <div class="crate">
                                            <a href="{{ crate.url|safe }}" target="_blank" rel="noopener">{{ crate.name }}</a>
                                            {% for run in crate.runs %}
                                                <span class="run">
                                                    {% if run %}
                                                        <b class="r{{ run.res }}"></b>
                                                        <a href="{{ run.log|safe }}/log.txt">
                                                            {{ result_names[run.res] }}
                                                        </a>
                                                    {% else %}
                                                        <b class="c{{ crate.res }}"></b>
                                                        {{ crate.res }}
                                                    {% endif %}
                                                </span>
                                            {% endfor %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                    {% endfor %}
                    </div>
                {% elif crates.RootResults %}
                    <div class="header c{{ name }} toggle" data-toggle="#crt-{{ name }}-rt">
                        {{ name }}: root results ({{ crates.RootResults.count }} different results, {{info[name]}} {{ name }} crates in total)
                    </div>
                    <div class="crates hidden" id="crt-{{ name }}-rt">
                    {% for result, subcrates in crates.RootResults.results %}
                            <div class="category">
                                <div class="header header-background subheader toggle" data-toggle="#{{ name }}-rt{{ loop.index }}">
                                    {{ result }} ({{ subcrates|length }})
                                </div>
                                <div class="crates" id="{{ name }}-rt{{ loop.index }}">
                                    {% for crate in subcrates %}
                                        <div class="crate">
                                            <a href="{{ crate.url|safe }}" target="_blank" rel="noopener">{{ crate.name }}</a>
                                            {% for run in crate.runs %}
                                                <span class="run">
                                                    {% if run %}
                                                        <b class="r{{ run.res }}"></b>
                                                        <a href="{{ run.log|safe }}/log.txt">
                                                            {{ result_names[run.res] }}
                                                        </a>
                                                    {% else %}
                                                        <b class="c{{ crate.res }}"></b>
                                                        {{ crate.res }}
                                                    {% endif %}
                                                </span>
                                            {% endfor %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                    {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class="nothing">
            {% if full %}
                No results available.
            {% else %}
                There are no relevant results.
                <a href="full.html">Check the full report</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
